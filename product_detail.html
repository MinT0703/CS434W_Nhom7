<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chi tiết sản phẩm — Store</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="page-detail">
  <!-- Header -->
  <header>
    <div class="container header-row">
      <div class="logo"><a href="index.html">store</a></div>
      <nav>
        <ul>
          <li><a href="index.html">Trang chủ</a></li>
          <li><a href="product.html">Sản phẩm</a></li>
          <li><a href="login.html">Đăng nhập</a></li>
          <li><a href="register.html">Đăng ký</a></li>
        </ul>
      </nav>
      <a class="icon-btn" href="cart.html" aria-label="Giỏ hàng">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M7 7h10l1.5 13H5.5L7 7Z" stroke="currentColor" stroke-width="1.6"/><path d="M9 9V6a3 3 0 1 1 6 0v3" stroke="currentColor" stroke-width="1.6"/></svg>
        <span id="cart-badge" class="badge">0</span>
      </a>
    </div>
  </header>

  <main class="container">
    <div class="crumbs"><a href="index.html">Home</a> / <a href="product.html">Sản phẩm</a> / <b>Skinny Jeans Aurora</b></div>

    <section class="wrap">
      <!-- Gallery -->
      <div class="gallery">
        <div class="stage" id="stage">
          <div class="off" id="off-badge">-25%</div>
        </div>
        <div class="thumbs" id="thumbs"></div>
      </div>

      <!-- Content -->
      <div class="content">
        <h1 class="title" id="p-name">Skinny Jeans Aurora</h1>
        <div class="rating" id="rating">
          <span id="stars">★★★★☆</span>
          <small>(124 đánh giá)</small>
        </div>

        <div class="price">
          <div class="now" id="p-price">599.000đ</div>
          <div class="old" id="p-old">799.000đ</div>
          <span class="stock" id="p-stock">Còn: 12</span>
        </div>

        <div class="opt">
          <div class="label">Màu sắc</div>
          <div class="colors" id="color-list"></div>
        </div>
        <div class="opt">
          <div class="label">Kích cỡ</div>
          <div class="sizes" id="size-list"></div>
        </div>

        <div class="qty-row">
          <div class="qty">
            <button id="minus">−</button>
            <input id="qty" type="number" value="1" min="1">
            <button id="plus">+</button>
          </div>
          <button class="btn" id="add">Add to cart</button>
        </div>

        <!-- Tabs -->
        <div class="tabs">
          <div class="tab-nav">
            <button class="tab-btn active" data-tab="desc">Mô tả</button>
            <button class="tab-btn" data-tab="spec">Thông số</button>
            <button class="tab-btn" data-tab="rev">Đánh giá</button>
          </div>
          <div class="tab-pane active" id="tab-desc">
            Quần jeans dáng skinny chất denim co giãn, thoải mái di chuyển. Phối hợp cùng áo basic cho phong cách hiện đại.
          </div>
          <div class="tab-pane" id="tab-spec">
            <table class="spec">
              <tr><td>Chất liệu</td><td>Denim 98% cotton, 2% spandex</td></tr>
              <tr><td>Giặt</td><td>Giặt nhẹ, không tẩy, phơi mát</td></tr>
              <tr><td>Thương hiệu</td><td>Nessa House</td></tr>
            </table>
          </div>
          <div class="tab-pane" id="tab-rev">
            Chưa có đánh giá. Hãy là người đầu tiên đánh giá sản phẩm này!
          </div>
        </div>
      </div>
    </section>

    <!-- Related -->
    <section class="rel">
      <h3 style="font-family:'Playfair Display',serif;margin:0 0 10px;color:#222">Sản phẩm liên quan</h3>
      <div class="grid" id="related">
        <div class="card">
          <div class="thumb-rel"></div>
          <div class="card-b">
            <div class="title-sm">Classic Denim Blue</div>
            <button class="btn-sm" onclick="quickAddRelated('Classic Denim Blue', 499)">Thêm nhanh</button>
          </div>
        </div>
        <div class="card">
          <div class="thumb-rel"></div>
          <div class="card-b">
            <div class="title-sm">High-rise Mom Jeans</div>
            <button class="btn-sm" onclick="quickAddRelated('High-rise Mom Jeans', 699)">Thêm nhanh</button>
          </div>
        </div>
        <div class="card">
          <div class="thumb-rel"></div>
          <div class="card-b">
            <div class="title-sm">Straight Jeans Mist</div>
            <button class="btn-sm" onclick="quickAddRelated('Straight Jeans Mist', 549)">Thêm nhanh</button>
          </div>
        </div>
        <div class="card">
          <div class="thumb-rel"></div>
          <div class="card-b">
            <div class="title-sm">Minimal Tote Bag</div>
            <button class="btn-sm" onclick="quickAddRelated('Minimal Tote Bag', 329)">Thêm nhanh</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ---------- Demo product & variants ----------
    const product = {
      id: 1,
      name: "Skinny Jeans Aurora",
      rating: 4.2,
      baseOff: 25,
      thumbs: [1,2,3,4], // 4 ảnh giả
      colors: [
        { code:"black",  name:"Black",  hex:"#222" },
        { code:"blue",   name:"Blue",   hex:"#2c6db4" },
        { code:"beige",  name:"Beige",  hex:"#E6D5C3" }
      ],
      sizes: ["S","M","L","XL"],
      variants: [
        // id, color, size, price(k), old(k), stock, image index
        { id:101, color:"black", size:"S", price:599, old:799, stock:8,  img:1, sku:"AUR-BLK-S" },
        { id:102, color:"black", size:"M", price:599, old:799, stock:12, img:2, sku:"AUR-BLK-M" },
        { id:103, color:"black", size:"L", price:599, old:799, stock:4,  img:3, sku:"AUR-BLK-L" },
        { id:104, color:"blue",  size:"M", price:589, old:0,   stock:9,  img:1, sku:"AUR-BLU-M" },
        { id:105, color:"blue",  size:"L", price:589, old:0,   stock:0,  img:2, sku:"AUR-BLU-L" }, // hết hàng
        { id:106, color:"beige", size:"M", price:619, old:749, stock:6,  img:4, sku:"AUR-BEI-M" }
      ]
    };

    // ---------- Helpers ----------
    const $ = (q, r=document)=>r.querySelector(q);
    const $$ = (q, r=document)=>[...r.querySelectorAll(q)];
    const fmtVNDk = k => k.toLocaleString('vi-VN') + '.000đ';
    const stars = r => '★'.repeat(Math.round(r)) + '☆'.repeat(5-Math.round(r));

    // ---------- State ----------
    let selColor = product.colors[0].code;
    let selSize  = product.sizes[1]; // M
    let qty = 1;
    let activeVariant = null;

    // ---------- UI init ----------
    function initGallery(){
      // stage background already styled; generate thumbnails
      const t = $('#thumbs'); t.innerHTML = '';
      product.thumbs.forEach((_,i)=>{
        const d = document.createElement('div');
        d.className = 'thumb' + (i===0?' active':'');
        d.dataset.idx = i+1;
        d.onclick = ()=>selectImage(i+1);
        t.appendChild(d);
      });
      selectImage(product.variants[1].img); // default
      $('#off-badge').style.display = product.baseOff? 'block':'none';
    }
    function selectImage(idx){
      $$('.thumb').forEach(th=>th.classList.toggle('active', th.dataset.idx==idx));
      // Demo only: change stage via gradient stripe position
      const s = $('#stage');
      s.style.background = `radial-gradient(140px 140px at 28% 18%, rgba(255,255,255,.38), transparent 45%), linear-gradient(135deg,#dcdcdc,#f5f5f5)`;
      // Add a subtle overlay shift per idx to simulate different images
      s.style.boxShadow = `inset 0 0 0 1px rgba(0,0,0,.05), 0 24px 70px rgba(17,17,17,.14)`;
    }

    function initColorSize(){
      // colors
      const c = $('#color-list'); c.innerHTML = '';
      product.colors.forEach(col=>{
        const b = document.createElement('button');
        b.className = 'color' + (col.code===selColor?' active':'');
        b.style.background = col.hex;
        b.title = col.name;
        b.onclick = ()=>{ selColor = col.code; refreshVariantUI(); };
        c.appendChild(b);
      });
      // sizes
      const s = $('#size-list'); s.innerHTML = '';
      product.sizes.forEach(sz=>{
        const btn = document.createElement('button');
        btn.className = 'size';
        btn.textContent = sz;
        btn.onclick = ()=>{ if(btn.disabled) return; selSize = sz; refreshVariantUI(); };
        s.appendChild(btn);
      });
    }

    function pickVariant(color, size){
      return product.variants.find(v=>v.color===color && v.size===size) || null;
    }

    function refreshVariantUI(){
      activeVariant = pickVariant(selColor, selSize);
      // Mark active color
      $$('#color-list .color').forEach(el=>{
        const hex = el.title.toLowerCase();
        el.classList.toggle('active', product.colors.find(c=>c.name.toLowerCase()===hex)?.code===selColor);
      });
      // Enable/disable sizes by color availability
      $$('#size-list .size').forEach(el=>{
        const sz = el.textContent;
        const v = pickVariant(selColor, sz);
        el.disabled = !v || v.stock<=0;
        el.classList.toggle('active', sz===selSize);
      });
      if(!activeVariant || activeVariant.stock<=0){
        // fallback to first available size for selected color
        const avail = product.sizes.find(sz=>pickVariant(selColor, sz) && pickVariant(selColor, sz).stock>0);
        if(avail){ selSize = avail; activeVariant = pickVariant(selColor, selSize); }
      }
      // Update price/stock/image
      if(activeVariant){
        $('#p-price').textContent = fmtVNDk(activeVariant.price);
        $('#p-old').style.display = activeVariant.old? 'inline':'none';
        $('#p-old').textContent = activeVariant.old? fmtVNDk(activeVariant.old):'';
        $('#p-stock').textContent = 'Còn: ' + activeVariant.stock;
        selectImage(activeVariant.img);
      }
    }

    function initQty(){
      const inp = $('#qty'); inp.value = qty;
      $('#minus').onclick = ()=>{ qty = Math.max(1, Number(inp.value||1)-1); inp.value=qty; };
      $('#plus').onclick  = ()=>{ qty = Math.max(1, Number(inp.value||1)+1); inp.value=qty; };
      inp.oninput = ()=>{ qty = Math.max(1, Number(inp.value||1)); };
    }

    function updateCartBadge(){
      const count = Number(localStorage.getItem('cartCount')||'0');
      $('#cart-badge').textContent = count;
    }

    function addToCart(){
      if(!activeVariant){ alert('Biến thể không khả dụng.'); return; }
      const quantity = Math.min(activeVariant.stock, Math.max(1, Number($('#qty').value||1)));
      const items = JSON.parse(localStorage.getItem('cartItems')||'[]');
      const idx = items.findIndex(x=>x.id===activeVariant.id);
      if(idx>-1){
        items[idx].qty = Math.min(items[idx].stock, items[idx].qty + quantity);
      }else{
        items.push({
          id: activeVariant.id,
          name: product.name + ' — ' + selColor.toUpperCase() + '/' + selSize,
          price: activeVariant.price,
          old: activeVariant.old||0,
          qty: quantity,
          stock: activeVariant.stock,
          sku: activeVariant.sku
        });
      }
      localStorage.setItem('cartItems', JSON.stringify(items));
      const newCount = items.reduce((a,b)=>a+(b.qty||1),0);
      localStorage.setItem('cartCount', String(newCount));
      updateCartBadge();
      alert('Đã thêm vào giỏ: ' + quantity + ' sản phẩm.');
    }

    function quickAddRelated(name, price){
      const items = JSON.parse(localStorage.getItem('cartItems')||'[]');
      const id = Math.floor(Math.random()*100000)+200; // demo id
      items.push({id, name, price, old:0, qty:1, stock:99});
      localStorage.setItem('cartItems', JSON.stringify(items));
      const newCount = items.reduce((a,b)=>a+(b.qty||1),0);
      localStorage.setItem('cartCount', String(newCount));
      updateCartBadge();
      alert('Đã thêm "'+name+'" vào giỏ.');
    }

    // Tabs
    function initTabs(){
      $$('.tab-btn').forEach(btn=>{
        btn.onclick = ()=>{
          $$('.tab-btn').forEach(b=>b.classList.toggle('active', b===btn));
          $$('.tab-pane').forEach(p=>p.classList.remove('active'));
          $('#tab-'+btn.dataset.tab).classList.add('active');
        };
      });
      $('#stars').textContent = stars(product.rating);
    }

    // ---------- Init ----------
    initGallery();
    initColorSize();
    refreshVariantUI();
    initQty();
    initTabs();
    updateCartBadge();

    // Add
    $('#add').onclick = addToCart;

    // Expose for related buttons
    window.quickAddRelated = quickAddRelated;
  </script>
</body>
</html>
