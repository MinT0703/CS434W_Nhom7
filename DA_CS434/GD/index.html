<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nessa Store</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="page-home">
  <!-- Header -->
  <header>
    <div class="container header-row">
      <div class="logo"><a href="#">Nessa House</a></div>
      <nav aria-label="Main">
        <ul>
          <li><a href="#">Trang chủ</a></li>
          <li><a href="product.html">Sản phẩm</a></li>
          <li><a href="login.html">Đăng nhập</a></li>
          <li><a href="register.html">Đăng ký</a></li>
        </ul>
      </nav>
      <div class="actions">
        <a class="icon-btn" href="cart.html" aria-label="Giỏ hàng">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M7 7h10l1.5 13H5.5L7 7Z" stroke="currentColor" stroke-width="1.6"/>
            <path d="M9 9V6a3 3 0 1 1 6 0v3" stroke="currentColor" stroke-width="1.6"/>
          </svg>
          <span id="cart-badge" class="badge">0</span>
        </a>
      </div>
    </div>
  </header>

  <!-- Hero Mockup -->
  <main class="container">
    <section class="hero" id="home">
      <div class="hero-grid">
        <div class="hero-left">
          <div class="frame-photo" role="img" aria-label="Ảnh mẫu thời trang (placeholder)"></div>
        </div>
        <div class="hero-right">
          <span class="badge-pill">40% OFF ALL STORE</span>
          <h1 class="title">Ultimate Sale</h1>
          <div class="subtitle">Ưu đãi cực lớn • Mua ngay hôm nay</div>
          <p class="desc">Phong cách tối giản, hiện đại với cặp font Playfair Display + Montserrat. Màu chủ đạo hồng đậm nổi bật trên nền pastel.</p>
          <div class="cta-row">
            <a class="btn" href="product.html">Shop Now</a>
            <span style="color:#7d5b5b">Miễn phí giao hàng cho đơn ≥ 499k</span>
          </div>
          <div style="display:grid;gap:12px">
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
              <div class="frame-photo" style="height:88px;aspect-ratio:auto;border-radius:12px;box-shadow:none;background:linear-gradient(0deg,rgba(0,0,0,.45),rgba(0,0,0,.12)),linear-gradient(135deg,#d9d9d9,#f0f0f0);display:grid;place-items:center;color:#fff;font-family:'Playfair Display',serif;font-weight:800;letter-spacing:.08em;text-transform:uppercase">Make up</div>
              <div class="frame-photo" style="height:88px;aspect-ratio:auto;border-radius:12px;box-shadow:none;background:linear-gradient(0deg,rgba(0,0,0,.45),rgba(0,0,0,.12)),linear-gradient(135deg,#d9d9d9,#f0f0f0);display:grid;place-items:center;color:#fff;font-family:'Playfair Display',serif;font-weight:800;letter-spacing:.08em;text-transform:uppercase">Accessories</div>
              <div class="frame-photo" style="height:88px;aspect-ratio:auto;border-radius:12px;box-shadow:none;background:linear-gradient(0deg,rgba(0,0,0,.45),rgba(0,0,0,.12)),linear-gradient(135deg,#d9d9d9,#f0f0f0);display:grid;place-items:center;color:#fff;font-family:'Playfair Display',serif;font-weight:800;letter-spacing:.08em;text-transform:uppercase">Jeans</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PRODUCTS SECTION -->
    <section id="products" aria-label="Danh sách sản phẩm">
      <div class="pagehead">
        <h2>Bộ sưu tập</h2>
      </div>

      <div class="layout">
        <!-- Sidebar filters -->
        <aside>
          <p class="aside-title">Bộ lọc</p>

          <div class="field">
            <label class="label" for="q">Tìm kiếm</label>
            <input id="q" type="text" placeholder="Từ khóa (ví dụ: jeans, bag...)" />
          </div>

          <div class="field">
            <div class="label">Danh mục</div>
            <label class="check"><input type="checkbox" class="cat" value="jeans" checked> Jeans</label>
            <label class="check"><input type="checkbox" class="cat" value="accessories" checked> Accessories</label>
            <label class="check"><input type="checkbox" class="cat" value="makeup" checked> Make up</label>
          </div>

          <div class="field">
            <div class="label">Khoảng giá (k)</div>
            <div class="range">
              <input id="minp" type="number" min="0" step="50" placeholder="Min" />
              <input id="maxp" type="number" min="0" step="50" placeholder="Max" />
            </div>
            <div style="font-size:12px;color:#9a8b8f;margin-top:6px">Ví dụ: 199 – 899</div>
          </div>

          <div class="field">
            <div class="label">Sắp xếp</div>
            <select id="sort">
              <option value="featured">Nổi bật</option>
              <option value="price-asc">Giá tăng dần</option>
              <option value="price-desc">Giá giảm dần</option>
              <option value="name-asc">Tên A → Z</option>
              <option value="name-desc">Tên Z → A</option>
            </select>
          </div>

          <div class="field" style="display:flex;gap:10px">
            <button id="apply" class="apply" type="button">Áp dụng</button>
            <button id="reset" class="apply reset" type="button">Reset</button>
          </div>
        </aside>

        <!-- Main content -->
        <section>
          <div class="toolbar">
            <div class="result"><span id="count">0</span> sản phẩm</div>
            <div class="sort">Sắp xếp nhanh:
              <select id="sort2">
                <option value="featured">Nổi bật</option>
                <option value="price-asc">Giá tăng dần</option>
                <option value="price-desc">Giá giảm dần</option>
                <option value="name-asc">Tên A → Z</option>
                <option value="name-desc">Tên Z → A</option>
              </select>
            </div>
          </div>

          <div id="grid" class="grid"></div>
          <div class="pagination" id="pagination"></div>
        </section>
      </div>
    </section>
  </main>

  <div id="toast" class="toast">Đã thêm vào giỏ hàng</div>

 <script>
const API_BASE = 'https://localhost:5001';

let cart = Number(localStorage.getItem('cartCount')||'0');
let currentPage = 1;
const perPage = 8;
let activeSort = 'featured';

const $ = (q, r=document)=>r.querySelector(q);
const $$ = (q, r=document)=>[...r.querySelectorAll(q)];
const fmtPriceK = k => k.toLocaleString('vi-VN') + 'k';
const stars = r => '★'.repeat(Math.round(r||0)) + '☆'.repeat(5 - Math.round(r||0));

function updateBadge(){ $('#cart-badge')?.textContent = cart; }

function renderCards(list){
  const grid = $('#grid'); if(!grid) return;
  grid.innerHTML = '';
  list.forEach(p=>{
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <div class="thumb"></div>
      <div class="card-body">
        <div class="title-sm">${p.name}</div>
        <div class="price">
          <div class="now">${fmtPriceK(p.priceK)}</div>
          ${p.oldK?`<div class="old">${fmtPriceK(p.oldK)}</div>`:''}
        </div>
        <div class="meta">
          <div class="stars" title="${(p.rating||4.3).toFixed(1)}/5">${stars(p.rating||4.3)}</div>
          <div class="stock">Còn: ${p.stock}</div>
        </div>
        <div class="cta"><button class="btn-add" data-id="${p.id}">Add to cart</button></div>
      </div>`;
    grid.appendChild(el);
  });
  $$('.btn-add').forEach(b=>b.addEventListener('click', ()=>{
    cart++; localStorage.setItem('cartCount', String(cart)); updateBadge();
    showToast('Đã thêm vào giỏ');
  }));
  $('#count')?.textContent = list.length;
}

function renderPagination(total, page=1, per=perPage){
  const pages = Math.max(1, Math.ceil(total/per));
  const el = $('#pagination'); if(!el) return;
  el.innerHTML = '';
  for(let i=1;i<=pages;i++){
    const b = document.createElement('button');
    b.className = 'page' + (i===page?' active':'');
    b.textContent = i;
    b.addEventListener('click', ()=>{ currentPage=i; applyFilters(); });
    el.appendChild(b);
  }
}

function getFilters(){
  const q = $('#q')?.value.trim() || '';
  const cats = $$('.cat').filter(c=>c.checked).map(c=>c.value);
  const minK = parseInt($('#minp')?.value || '0', 10);
  const maxK = parseInt($('#maxp')?.value || '999999', 10);
  return { q, cats, minK, maxK };
}

async function fetchProducts({ q, cats, minK, maxK, sort, page, per }){
  const params = new URLSearchParams();
  if(q) params.set('q', q);
  (cats||[]).forEach(c=>params.append('cats', c));
  if(Number.isFinite(minK)) params.set('minK', String(minK));
  if(Number.isFinite(maxK)) params.set('maxK', String(maxK));
  if(sort && sort!=='featured') params.set('sort', sort);
  params.set('page', String(page||1));
  params.set('per', String(per||perPage));
  const res = await fetch(`${API_BASE}/api/products?`+params.toString());
  if(!res.ok) throw new Error('Load products failed');
  return res.json(); // { total, items }
}

async function applyFilters(){
  try{
    const { q, cats, minK, maxK } = getFilters();
    const { total, items } = await fetchProducts({ q, cats, minK, maxK, sort: activeSort, page: currentPage, per: perPage });
    renderCards(items);
    renderPagination(total, currentPage, perPage);
  }catch(e){ console.error(e); showToast('Không tải được sản phẩm'); }
}

function showToast(msg){
  const t = $('#toast'); if(!t) return;
  t.textContent = msg; t.classList.add('show');
  clearTimeout(showToast._t); showToast._t = setTimeout(()=>t.classList.remove('show'), 1600);
}

// Events
$('#apply')?.addEventListener('click', ()=>{ currentPage=1; activeSort=$('#sort')?.value||'featured'; $('#sort2') && ($('#sort2').value=activeSort); applyFilters(); });
$('#reset')?.addEventListener('click', ()=>{
  $('#q') && ($('#q').value=''); $$('.cat').forEach(c=>c.checked=true);
  $('#minp') && ($('#minp').value=''); $('#maxp') && ($('#maxp').value='');
  $('#sort') && ($('#sort').value='featured'); $('#sort2') && ($('#sort2').value='featured');
  currentPage=1; activeSort='featured'; applyFilters();
});
$('#sort2')?.addEventListener('change', e=>{ activeSort=e.target.value; currentPage=1; $('#sort') && ($('#sort').value=activeSort); applyFilters(); });
$('#q')?.addEventListener('keydown', e=>{ if(e.key==='Enter'){ currentPage=1; applyFilters(); } });

// Init
updateBadge();
applyFilters();
</script>

</body>
</html>
